<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Rodent BMI Alerts</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>

.navbar {
  background: linear-gradient(90deg, #263238, #37474f);
  padding: 14px 20px;
  display: flex;
  gap: 18px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
}

.navbar a {
  color: #ffffff;
  text-decoration: none;
  font-weight: 600;
  padding: 8px 14px;
  border-radius: 8px;
  transition: all 0.3s ease;
  font-size: 15px;
}

.navbar a:hover {
  background: #ff9800;
  color: #000;
  transform: translateY(-2px);
}


  body {
    font-family: 'Segoe UI', sans-serif;
    background: #fff3e0;
    padding: 20px;
  }
  h2 {
    text-align: center;
    color: #e65100;
  }
  .top-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
  }
  button {
    padding: 8px 12px;
    font-size: 14px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    background: #ff9800;
    color: #fff;
  }
  .card {
    background: #ffffff;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    margin-bottom: 12px;
  }
  .UNDERWEIGHT { border-left: 6px solid #1976d2; }
  .OVERWEIGHT { border-left: 6px solid #f57c00; }
  .OBESE { border-left: 6px solid #d32f2f; }
</style>
</head>

<body>
<nav class="navbar">
  <a href="index.html"   target="_blank">üè† Dashboard</a>
  <a href="records.html" target="_blank">üìã Records</a>
  <a href="trends.html"  target="_blank">üìà Trends</a>
  <a href="alerts.html"  target="_blank">üö® Alerts</a>
  <a href="about.html"   target="_blank">‚ÑπÔ∏è About</a>
</nav>


<h2>üö® Abnormal BMI Alerts</h2>

<div class="top-bar">
  <div><b>Showing:</b> Underweight, Overweight, Obese</div>
  <button id="sortBtn" onclick="toggleSort()">Sort: Recent ‚Üí Oldest</button>
</div>

<div id="alertContainer"></div>

<script>
/* ---------- Firebase ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyDv704GB8rX4ZX7AZ14Bjc1MCQ2sXYdd7A",
  authDomain: "rodent-bmi-monitor.firebaseapp.com",
  databaseURL: "https://rodent-bmi-monitor-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "rodent-bmi-monitor",
  storageBucket: "rodent-bmi-monitor.firebasestorage.app",
  messagingSenderId: "729549308040",
  appId: "1:729549308040:web:4c86948f8e637b17991f3d"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ---------- State ---------- */
let alerts = [];
let recentFirst = true;

/* ---------- Load Alerts ---------- */
db.ref("rodent_data").on("value", snapshot => {

  alerts = [];

  snapshot.forEach(rodentSnap => {

    const rodentId = rodentSnap.key;

    const meta = rodentSnap.child("metadata").val() || {};
    const drug = meta.drug || "‚Äî";
    const dose = meta.dose_mg_per_kg || "‚Äî";

    rodentSnap.child("records").forEach(recSnap => {
      const d = recSnap.val();

      if (
        d.condition === "UNDERWEIGHT" ||
        d.condition === "OVERWEIGHT" ||
        d.condition === "OBESE"
      ) {
        alerts.push({
          rodentId: rodentId,
          condition: d.condition,
          lee: d.lee_index,
          time: d.timestamp,
          drug: drug,
          dose: dose
        });
      }
    });
  });

  renderAlerts();
});

/* ---------- Render Alerts ---------- */
function renderAlerts() {

  const container = document.getElementById("alertContainer");
  container.innerHTML = "";

  alerts.sort((a, b) =>
    recentFirst ? b.time - a.time : a.time - b.time
  );

  alerts.forEach(a => {

    const div = document.createElement("div");
    div.className = "card " + a.condition;

    div.innerHTML = `
      üê≠ <b>Rodent ID:</b> ${a.rodentId}<br>
      <b>Condition:</b> ${a.condition}<br>
      <b>Lee Index:</b> ${a.lee}
      &nbsp;&nbsp;|&nbsp;&nbsp;
      <b>Drug:</b> ${a.drug}
      &nbsp;&nbsp;|&nbsp;&nbsp;
      <b>Dose:</b> ${a.dose} mg/kg<br>
      <b>Time:</b> ${new Date(a.time).toLocaleString()}
    `;

    container.appendChild(div);
  });
}

/* ---------- Toggle Sort ---------- */
function toggleSort() {
  recentFirst = !recentFirst;
  document.getElementById("sortBtn").innerText =
    recentFirst
      ? "Sort: Recent ‚Üí Oldest"
      : "Sort: Oldest ‚Üí Recent";
  renderAlerts();
}
</script>

</body>
</html>
